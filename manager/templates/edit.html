<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor: {{ project_id }} - Debian Site Factory</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        /* Spezifische Styles für den Dateimanager */
        .editor-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 1rem;
            height: calc(100vh - 180px); /* Fensterhöhe minus Header */
            min-height: 500px;
        }
        .file-browser {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
        }
        .file-browser h3 {
            margin-top: 0;
            font-size: 1rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .file-link {
            display: block;
            padding: 0.5rem;
            color: var(--text-secondary);
            border-radius: 4px;
            margin-bottom: 2px;
            font-size: 0.9rem;
            text-decoration: none;
            word-break: break-all;
        }
        .file-link:hover {
            background: #2a2a2a;
            color: var(--text-primary);
        }
        .file-link.active {
            background: var(--accent-color);
            color: white;
        }
        .editor-main {
            display: flex;
            flex-direction: column;
        }
        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            background: var(--card-bg);
            padding: 0.5rem;
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }
        .filename-display {
            font-family: monospace;
            color: var(--text-primary);
            font-weight: bold;
        }
        textarea {
            flex-grow: 1;
            width: 100%;
            height: 100%;
            padding: 1rem;
            background-color: #1e1e1e;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: #d4d4d4;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: none;
            box-sizing: border-box;
        }
        textarea:focus {
            outline: none;
            border-color: var(--accent-color);
        }
        .help-text {
            font-size: 0.8rem; 
            color: var(--text-secondary); 
            margin-top: auto; 
            padding-top: 1rem;
        }
    </style>
</head>
<body>
    <div class="container" style="max-width: 95%;">
        <header>
            <div style="display:flex; align-items:center; gap:1rem;">
                <a href="/" class="btn btn-secondary btn-sm">← Back</a>
                <h1>Editing: {{ project_id }}</h1>
            </div>
            <div class="project-actions">
                <a href="/sites/{{ project_id }}/" target="_blank" class="btn btn-secondary">View Site</a>
            </div>
        </header>

        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <ul class="flashes">
                {% for message in messages %}
                <li>{{ message }}</li>
                {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}

        <div class="editor-container">
            <div class="file-browser">
                <h3>Files</h3>
                {% for f in files %}
                    <a href="{{ url_for('edit_project', project_id=project_id, file=f) }}" 
                       class="file-link {% if f == current_file %}active{% endif %}">
                       {{ f }}
                    </a>
                {% endfor %}
                
                <div class="help-text">
                    <strong>Tipp:</strong> Um eine neue Datei zu erstellen, geben Sie den Namen einfach oben in der URL an (z.B. <code>?file=css/neu.css</code>) und speichern Sie.
                </div>
            </div>

            <form action="{{ url_for('edit_project', project_id=project_id, file=current_file) }}" method="post" class="editor-main">
                <div class="editor-header">
                    <span class="filename-display">{{ current_file }}</span>
                    {% if not is_binary %}
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    {% endif %}
                </div>

                {% if is_binary %}
                    <div class="empty-state">
                        <p>⚠️ Dies ist eine Binärdatei (z.B. Bild).<br>Bearbeitung im Browser nicht möglich.</p>
                    </div>
                {% else %}
                    <textarea name="file_content" spellcheck="false">{{ file_content }}</textarea>
                {% endif %}
            </form>
        </div>
    </div>
</body>
</html>
